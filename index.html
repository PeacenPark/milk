<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜¨,ê²¸ ìˆ˜ìœ ì¼ì§€</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#4caf50" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: #f5f5f5;
      font-size: 22px;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: white;
      flex-wrap: wrap;
    }
    #titleBox h1 {
      font-size: 32px;
      margin: 0;
      color: #333;
    }
    #dday {
      font-size: 20px;
      color: #666;
    }
    #dateSelect {
      font-size: 20px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }
    #selectedBabyBox {
      text-align: center;
      margin-top: 20px;
    }
    #selectedBabyBox img {
      height: 180px;
      object-fit: contain;
      border-radius: 10px;
      vertical-align: middle;
      margin-right: 10px;
    }
    #selectedBabyName {
      font-size: 36px;
      font-weight: bold;
      color: #2e7d32;
      display: inline-block;
      vertical-align: middle;
    }
    .babyBtn {
      width: 120px;
      height: 120px;
      border-radius: 60px;
      border: 3px solid #4caf50;
      background: #e8f5e9;
      color: #2e7d32;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .babyBtn.selected {
      background: #4caf50;
      color: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
    select, input, button, textarea {
      font-size: 22px;
      padding: 12px;
      margin-top: 10px;
      width: 100%;
      border-radius: 10px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background: linear-gradient(45deg, #4caf50, #66bb6a);
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: linear-gradient(45deg, #388e3c, #4caf50);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 12px;
      text-align: center;
      font-size: 20px;
    }
    .feedTimeHighlight {
      font-size: 30px;
      font-weight: bold;
      color: #d32f2f;
    }
    .highlightFeed {
      font-size: 28px;
      font-weight: bold;
      color: #ff5722;
    }
  </style>
</head>
<body onload="initApp()">
  <header>
    <div id="titleBox">
      <h1>ì˜¨, ê²¸ ìˆ˜ìœ ì¼ì§€</h1>
      <div id="dday"></div>
    </div>
    <select id="dateSelect" onchange="loadLogs()"></select>
  </header>

  <div id="selectedBabyBox">
    <img id="babyImage" src="IMG_1186.png" alt="baby" />
    <span id="selectedBabyName">ë°• ì˜¨</span>
  </div>

  <div style="text-align: center; margin-top: 20px;">
    <button onclick="selectBaby('ë°• ì˜¨')" id="btnOn" class="babyBtn selected">ë°• ì˜¨</button>
    <button onclick="selectBaby('ë°• ê²¸')" id="btnGyeom" class="babyBtn">ë°• ê²¸</button>
  </div>

  <select id="baby" style="display:none;">
    <option value="ë°• ì˜¨">ë°• ì˜¨</option>
    <option value="ë°• ê²¸">ë°• ê²¸</option>
  </select>
    <div style="max-width: 1200px; margin: auto; padding: 20px;">
    <div style="display: flex; gap: 10px; margin-top: 10px;">
      <input type="date" id="inputDate">
      <input type="time" id="time">
    </div>

    <select id="feedAmount">
      <option value="" selected>ìˆ˜ìœ ëŸ‰ (mL)</option>
      <option value="30">30 mL</option>
      <option value="40">40 mL</option>
      <option value="50">50 mL</option>
      <option value="60">60 mL</option>
      <option value="70">70 mL</option>
      <option value="80">80 mL</option>
      <option value="90">90 mL</option>
      <option value="100">100 mL</option>
      <option value="110">110 mL</option>
      <option value="120">120 mL</option>
      <option value="130">130 mL</option>
      <option value="140">140 mL</option>
      <option value="150">150 mL</option>
      <option value="160">160 mL</option>
      <option value="170">170 mL</option>
      <option value="180">180 mL</option>
      <option value="190">190 mL</option>
      <option value="200">200 mL</option>
    </select>

    <select id="poopType">
      <option value="">ëŒ€ë³€</option>
      <option value="ì •ìƒ">ì •ìƒ</option>
      <option value="ëœë³€">ëœë³€</option>
      <option value="ë¬½ì€ë³€">ë¬½ì€ë³€</option>
      <option value="ì„¤ì‚¬">ì„¤ì‚¬</option>
    </select>

    <label style="font-size: 20px;"><input type="checkbox" id="pee" /> ì†Œë³€</label>
    <button onclick="saveLog()">ê¸°ë¡ ì €ì¥</button>

    <h3 style="margin-top:40px;">í•˜ë£¨ ì¼ì§€</h3>
    <table>
      <thead><tr><th>ëª¸ë¬´ê²Œ</th><th>ì²´ì˜¨</th><th>ëª©ìš•</th><th>ì €ì¥</th></tr></thead>
      <tbody><tr>
        <td><input type="number" id="weight" step="0.1" placeholder="kg"></td>
        <td><input type="number" id="temperature" step="0.1" placeholder="â„ƒ"></td>
        <td><input type="checkbox" id="bathed" style="transform: scale(1.5);"></td>
        <td><button onclick="saveDailyNote()">ì €ì¥</button></td>
      </tr></tbody>
    </table>

    <textarea id="memo" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="margin-top:10px;"></textarea>

    <div id="dailySummaryBox" style="background:#e0f7fa; font-size:20px; padding:16px; border-radius:10px; margin-top:30px;"></div>

    <table>
      <thead><tr><th>ì‹œê°„</th><th>ìˆ˜ìœ ëŸ‰</th><th>ëŒ€ë³€</th><th>ì†Œë³€</th><th>ê´€ë¦¬</th></tr></thead>
      <tbody id="logTable"><tr><td colspan="5">ê¸°ë¡ ì—†ìŒ</td></tr></tbody>
    </table>

    <button onclick="downloadAllLogsAsPDF()" style="margin-top: 40px;">ğŸ“„ ì „ì²´ PDF ë°±ì—…</button>
  </div>
  <script>
  const { jsPDF } = window.jspdf;

  // âœ… NotoSansKR Base64 í°íŠ¸ (ë¶€ë¶„ ì˜ˆì‹œ, ì‹¤ì œì—ì„  ì „ì²´ Base64 ì‚½ì… í•„ìš”)
  const notoSansKR = 'AAEAAAALAIAAAwAwT1MvM...'; // ğŸ‘‰ ì‹¤ì œ ë³€í™˜ëœ ì „ì²´ Base64ë¡œ êµì²´í•˜ì„¸ìš”!

  jsPDF.API.events.push(["addFonts", function () {
    this.addFileToVFS("NotoSansKR-Regular.ttf", notoSansKR);
    this.addFont("NotoSansKR-Regular.ttf", "NotoSansKR", "normal");
  }]);

  let sharedData = {};

  function initApp() {
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('inputDate').value = today;
    document.getElementById('time').value = getNowTime();
    selectBaby("ë°• ì˜¨");
    updateDateSelect();
    loadLogs();
  }

  function getNowTime() {
    const now = new Date();
    return `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
  }

  function selectBaby(name) {
    document.getElementById("baby").value = name;
    document.getElementById("selectedBabyName").textContent = name;
    document.getElementById("babyImage").src = name === "ë°• ì˜¨" ? "IMG_1186.png" : "IMG_1185.png";
    document.getElementById("btnOn").classList.toggle("selected", name === "ë°• ì˜¨");
    document.getElementById("btnGyeom").classList.toggle("selected", name === "ë°• ê²¸");
    loadLogs();
  }

  function saveLog() {
    const date = document.getElementById("inputDate").value;
    const time = document.getElementById("time").value;
    const baby = document.getElementById("baby").value;
    const feedAmount = parseInt(document.getElementById("feedAmount").value) || 0;
    const poopType = document.getElementById("poopType").value;
    const pee = document.getElementById("pee").checked;

    if (!sharedData[date]) sharedData[date] = {};
    if (!sharedData[date][baby]) sharedData[date][baby] = { logs: [], daily: {} };
    sharedData[date][baby].logs.unshift({ time, feedAmount, poopType, pee });

    updateDateSelect();
    loadLogs();

    document.getElementById("feedAmount").selectedIndex = 0;
    document.getElementById("poopType").value = '';
    document.getElementById("pee").checked = false;
  }

  function saveDailyNote() {
    const date = document.getElementById("dateSelect").value;
    const baby = document.getElementById("baby").value;
    const weight = parseFloat(document.getElementById("weight").value) || null;
    const temperature = parseFloat(document.getElementById("temperature").value) || null;
    const bathed = document.getElementById("bathed").checked;
    const memo = document.getElementById("memo").value;

    if (!sharedData[date]) sharedData[date] = {};
    if (!sharedData[date][baby]) sharedData[date][baby] = { logs: [], daily: {} };
    sharedData[date][baby].daily = { weight, temperature, bathed, memo };
    loadLogs();
  }

  function updateDateSelect() {
    const select = document.getElementById("dateSelect");
    const dates = Object.keys(sharedData).sort().reverse();
    select.innerHTML = '';
    dates.forEach(date => {
      const opt = document.createElement("option");
      opt.value = date;
      opt.textContent = date;
      select.appendChild(opt);
    });
    if (dates.length > 0) select.value = dates[0];
  }

  function loadLogs() {
    const date = document.getElementById("dateSelect").value;
    const baby = document.getElementById("baby").value;
    const logs = (sharedData[date] && sharedData[date][baby]?.logs) || [];
    const note = (sharedData[date] && sharedData[date][baby]?.daily) || {};

    document.getElementById("weight").value = note.weight || '';
    document.getElementById("temperature").value = note.temperature || '';
    document.getElementById("bathed").checked = note.bathed || false;
    document.getElementById("memo").value = note.memo || '';

    const tbody = document.getElementById("logTable");
    tbody.innerHTML = '';

    logs.forEach((log, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${log.time}</td>
        <td>${log.feedAmount || '-'}</td>
        <td>${log.poopType || '-'}</td>
        <td>${log.pee ? 'O' : ''}</td>
        <td><button onclick="deleteLog('${date}', '${baby}', ${i})">ğŸ—‘</button></td>
      `;
      tbody.appendChild(tr);
    });

    document.getElementById("dailySummaryBox").innerHTML =
      `<strong>${date} ${baby} ìš”ì•½</strong><br>
       ìˆ˜ìœ ëŸ‰: ${logs.reduce((s, l) => s + (l.feedAmount || 0), 0)}mL,
       ëŒ€ë³€ ${logs.filter(l => l.poopType).length}íšŒ,
       ì†Œë³€ ${logs.filter(l => l.pee).length}íšŒ`;
  }

  function deleteLog(date, baby, index) {
    sharedData[date][baby].logs.splice(index, 1);
    loadLogs();
  }

  function downloadAllLogsAsPDF() {
    const doc = new jsPDF();
    doc.setFont("NotoSansKR");
    doc.setFontSize(14);
    const dates = Object.keys(sharedData).sort();
    let pageCount = 0;

    for (const date of dates) {
      for (const baby of Object.keys(sharedData[date])) {
        if (pageCount > 0) doc.addPage();
        pageCount++;

        const logs = sharedData[date][baby].logs || [];
        const daily = sharedData[date][baby].daily || {};
        let y = 20;

        doc.text(`${date} - ${baby} ìˆ˜ìœ ì¼ì§€`, 14, y); y += 10;
        if (daily.weight) doc.text(`ëª¸ë¬´ê²Œ: ${daily.weight}kg`, 14, y);
        if (daily.temperature) doc.text(`  ì²´ì˜¨: ${daily.temperature}â„ƒ`, 80, y);
        if (daily.bathed) doc.text(`  ëª©ìš•: O`, 140, y);
        y += 10;
        if (daily.memo) {
          const memoLines = doc.splitTextToSize(`ë©”ëª¨: ${daily.memo}`, 180);
          doc.text(memoLines, 14, y);
          y += memoLines.length * 7;
        }

        doc.text("ì‹œê°„ | ìˆ˜ìœ ëŸ‰ | ëŒ€ë³€ | ì†Œë³€", 14, y); y += 8;
        logs.forEach(log => {
          doc.text(`${log.time} | ${log.feedAmount || '-'}mL | ${log.poopType || '-'} | ${log.pee ? 'O' : '-'}`, 14, y);
          y += 7;
        });
      }
    }

    doc.save("ìˆ˜ìœ ì¼ì§€.pdf");
  }
</script>
</body>
</html>
