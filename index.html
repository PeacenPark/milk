<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>온,겸 수유일지</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#4caf50">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
  <style>
    body { font-family: 'Arial', sans-serif; background: #f5f5f5; font-size: 22px; margin: 0; padding: 0; }
    header { display: flex; justify-content: space-between; align-items: center; padding: 20px; background: white; flex-wrap: wrap; }
    #titleBox h1 { font-size: 32px; margin: 0; color: #333; }
    #dday { font-size: 20px; color: #666; }
    #dateSelect { font-size: 20px; padding: 10px; border-radius: 10px; border: 1px solid #ccc; }
    #selectedBabyBox { text-align: center; margin-top: 20px; }
    #selectedBabyBox img { height: 200px; object-fit: contain; border-radius: 10px; vertical-align: middle; margin-right: 10px; }
    #selectedBabyName { font-size: 36px; font-weight: bold; color: #2e7d32; display: inline-block; vertical-align: middle; }
    select, input, button, textarea {
      font-size: 22px; padding: 12px; margin-top: 10px; width: 100%;
      border-radius: 10px; border: 1px solid #ccc; box-sizing: border-box;
    }
    button {
      background: linear-gradient(45deg, #4caf50, #66bb6a);
      color: white; font-weight: bold; border: none; cursor: pointer;
    }
    button:hover { background: linear-gradient(45deg, #388e3c, #4caf50); }
    table { width: 100%; border-collapse: collapse; background: #fff; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 12px; text-align: center; font-size: 20px; }
    .row { display: flex; gap: 10px; margin-top: 10px; }
    .row > * { flex: 1; }
    #infoTable td {
      font-size: 24px; color: #2e7d32; font-weight: bold; padding: 16px;
    }
    .feedTimeHighlight { font-size: 36px; font-weight: bold; color: #d32f2f; }
    .highlightFeed { font-size: 28px; font-weight: bold; color: #ff5722; }
    .babyBtn {
      width: 120px; height: 120px; border-radius: 60px; border: 3px solid #4caf50;
      background: #e8f5e9; color: #2e7d32; font-size: 24px; font-weight: bold;
      cursor: pointer; transition: all 0.3s ease;
    }
    .babyBtn.selected {
      background: #4caf50; color: white; box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body onload="initApp()">
  <header>
    <div id="titleBox">
      <h1>온, 겸 수유일지</h1>
      <div id="dday"></div>
    </div>
    <select id="dateSelect" onchange="loadLogs()"></select>
  </header>

  <div id="selectedBabyBox">
    <img id="babyImage" src="IMG_1186.png" alt="baby" />
    <span id="selectedBabyName">박 온</span>
  </div>

  <div id="babySelector" style="display: flex; justify-content: center; gap: 20px; margin: 20px 0;">
    <button onclick="selectBaby('박 온')" id="btnOn" class="babyBtn selected">박 온</button>
    <button onclick="selectBaby('박 겸')" id="btnGyeom" class="babyBtn">박 겸</button>
  </div>

  <!-- 수유텀 설정 드롭다운 -->
  <div style="text-align:center; margin-bottom: 10px;">
    <label style="font-size:20px;">
      수유텀:
      <select id="feedInterval" onchange="updateIntervalSetting()">
        <option value="120">2시간</option>
        <option value="150">2시간 30분</option>
        <option value="180">3시간</option>
        <option value="210">3시간 30분</option>
        <option value="240">4시간</option>
        <option value="270">4시간 30분</option>
        <option value="300">5시간</option>
        <option value="330">5시간 30분</option>
        <option value="360">6시간</option>
      </select>
    </label>
  </div>

  <select id="baby" style="display:none;">
    <option value="박 온">박 온</option>
    <option value="박 겸">박 겸</option>
  </select>

  <table id="infoTable"><tr><td><span id="nextFeedTime">다음 수유 시간: -</span></td></tr></table>
    <div style="max-width: 1200px; margin: auto; padding: 20px;">
    <div class="row">
      <input type="date" id="inputDate">
      <input type="time" id="time">
    </div>

    <select id="feedAmount">
      <option value="" selected>수유량 (mL)</option>
      ${[...Array(18)].map((_, i) => `<option value="${(i+3)*10}">${(i+3)*10} mL</option>`).join('')}
    </select>

    <select id="poopType">
      <option value="">대변</option>
      <option value="정상">정상</option>
      <option value="된변">된변</option>
      <option value="묽은변">묽은변</option>
      <option value="설사">설사</option>
    </select>

    <label style="font-size: 20px;"><input type="checkbox" id="pee" /> 소변</label>
    <button onclick="saveLog()">기록 저장</button>

    <h3 style="margin-top:40px;">하루 일지</h3>
    <table>
      <thead><tr><th>몸무게</th><th>체온</th><th>목욕</th><th>저장</th></tr></thead>
      <tbody><tr>
        <td><input type="number" id="weight" step="0.1" placeholder="kg"></td>
        <td><input type="number" id="temperature" step="0.1" placeholder="℃"></td>
        <td><input type="checkbox" id="bathed" style="transform: scale(1.5);"></td>
        <td><button onclick="saveDailyNote()">저장</button></td>
      </tr></tbody>
    </table>

    <textarea id="memo" placeholder="메모를 입력하세요" style="margin-top:10px;"></textarea>
    <div id="dailySummaryBox" style="background:#e0f7fa; font-size:20px; padding:16px; border-radius:10px; margin-top:30px;"></div>

    <table>
      <thead><tr><th>시간</th><th>수유량</th><th>대변</th><th>소변</th><th>관리</th></tr></thead>
      <tbody id="logTable"><tr><td colspan="5">기록 없음</td></tr></tbody>
    </table>
    <canvas id="feedChart" height="250"></canvas>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCC5LID8sgqNYfG9lUY32m4CDL2f11x2aY",
      authDomain: "feeding-log-d88a6.firebaseapp.com",
      projectId: "feeding-log-d88a6",
      storageBucket: "feeding-log-d88a6.appspot.com",
      messagingSenderId: "175054478050",
      appId: "1:175054478050:web:aedca7675e674c44c35cbb"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const docRef = db.collection("logs").doc("shared-log");
    let sharedData = {};

    function initApp() {
      const today = getTodayDate();
      document.getElementById('inputDate').value = today;
      document.getElementById('time').value = getNowTime();
      updateDday();
      docRef.onSnapshot((doc) => {
        sharedData = doc.exists ? doc.data() : {};
        updateDateSelect();
        loadLogs();
        drawChart();
      });
      selectBaby('박 온');
    }

    function getNowTime() {
      const now = new Date();
      return `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
    }

    function to12HourFormat(timeStr) {
      const [h, m] = timeStr.split(':').map(Number);
      const ampm = h >= 12 ? '오후' : '오전';
      const hour12 = h % 12 || 12;
      return `${ampm} ${hour12}:${String(m).padStart(2, '0')}`;
    }

    function updateDday() {
      const base = new Date("2025-01-06");
      const today = new Date();
      const diff = Math.floor((today - base) / (1000 * 60 * 60 * 24));
      document.getElementById('dday').textContent = `생후 ${diff}일`;
    }

    function selectBaby(name) {
      document.getElementById('baby').value = name;
      document.getElementById('selectedBabyName').textContent = name;
      document.getElementById('babyImage').src = name === '박 온' ? 'IMG_1186.png' : 'IMG_1185.png';
      document.getElementById('btnOn').classList.toggle('selected', name === '박 온');
      document.getElementById('btnGyeom').classList.toggle('selected', name === '박 겸');
      updateIntervalUI();
      loadLogs();
      drawChart();
    }

    function updateIntervalSetting() {
      const baby = document.getElementById('baby').value;
      const interval = document.getElementById('feedInterval').value;
      localStorage.setItem(`interval-${baby}`, interval);
    }

    function getIntervalForBaby(baby) {
      return parseInt(localStorage.getItem(`interval-${baby}`) || '210');
    }

    function updateIntervalUI() {
      const baby = document.getElementById('baby').value;
      const interval = getIntervalForBaby(baby);
      document.getElementById('feedInterval').value = interval;
    }

    function setNextFeedTimeLabel(timeStr) {
      const baby = document.getElementById('baby').value;
      const intervalMin = getIntervalForBaby(baby);
      const [h, m] = timeStr.split(':').map(Number);
      const dt = new Date();
      dt.setHours(h);
      dt.setMinutes(m + intervalMin);
      const hh = String(dt.getHours()).padStart(2, '0');
      const mm = String(dt.getMinutes()).padStart(2, '0');
      const timeText = to12HourFormat(`${hh}:${mm}`);
      document.getElementById('nextFeedTime').innerHTML =
        `다음 수유 시간: <span class="feedTimeHighlight">${timeText}</span>`;
    }

    // 기존 saveLog, loadLogs 등 기존 로직은 그대로 아래에 유지

  </script>
</body>
</html>